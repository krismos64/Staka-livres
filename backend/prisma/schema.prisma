generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(uuid())
  prenom    String
  nom       String
  email     String     @unique
  password  String
  role      Role       @default(USER)
  isActive  Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  commandes Commande[]

  @@map("users")
}

model Commande {
  id              String         @id @default(uuid())
  userId          String
  titre           String
  description     String?
  fichierUrl      String?
  statut          StatutCommande @default(EN_ATTENTE)
  noteClient      String?
  noteCorrecteur  String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  paymentStatus   String?
  stripeSessionId String?
  amount          Int? // Montant en centimes
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  invoices        Invoice[] // Relation vers les factures

  @@index([userId], map: "commandes_userId_fkey")
  @@map("commandes")
}

enum Role {
  USER
  ADMIN
}

model Invoice {
  id         String   @id @default(uuid())
  commande   Commande @relation(fields: [commandeId], references: [id], onDelete: Cascade)
  commandeId String
  amount     Int // Montant en centimes
  pdfUrl     String // URL du PDF sur S3
  createdAt  DateTime @default(now())

  @@map("invoices")
}

enum StatutCommande {
  EN_ATTENTE
  EN_COURS
  TERMINE
  ANNULEE
}
